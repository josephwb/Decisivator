This is undergoing essentially a complete rewrite.